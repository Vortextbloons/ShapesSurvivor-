<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Shapes Survivor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="state-mainmenu">

    <div id="tooltip"></div>

    <div id="dev-mode-indicator" aria-live="polite" aria-atomic="true"></div>

    <div id="dev-perf-overlay" aria-live="polite" aria-atomic="true"></div>

    <div id="run-info" class="run-info" aria-live="polite" aria-atomic="true">
        <div class="run-info-item"><span class="run-info-label">Time</span><span id="run-time" class="run-info-value">0:00</span></div>
        <div class="run-info-divider"></div>
        <div class="run-info-item"><span class="run-info-label">Kills</span><span id="run-kills" class="run-info-value">0</span></div>
    </div>

    <div id="boss-warning" class="boss-warning" style="display: none;">
        <div class="boss-warning-text">⚠ CLEAR REMAINING ENEMIES ⚠</div>
        <div class="boss-warning-subtext">Boss incoming...</div>
    </div>

    <!-- Mobile controls (shown on touch devices only via CSS) -->
    <div id="mobile-controls" class="mobile-controls" aria-hidden="true">
        <div id="mobile-joystick" class="mobile-joystick">
            <div class="mobile-joystick-base"></div>
            <div id="mobile-joystick-knob" class="mobile-joystick-knob"></div>
        </div>
        <button id="mobile-inv-btn" class="mobile-action-btn" type="button">Inventory</button>
    </div>

    <div id="hud">
        <div class="stat-label">Health</div>
        <div id="hp-bar" class="bar-container">
            <div class="bar-fill" id="hp-fill"></div>
            <div class="bar-text" id="hp-text">0/0</div>
        </div>
        <div class="stat-label">Experience (Lvl <span id="lvl-display">1</span>)</div>
        <div id="xp-bar" class="bar-container">
            <div class="bar-fill" id="xp-fill"></div>
            <div class="bar-text" id="xp-text">0/0</div>
        </div>

        <div class="stat-label">Buffs</div>
        <div id="buffs-panel" class="buffs-panel"></div>
    </div>

    <button id="toggle-inv-btn" class="btn" onclick="Game.toggleInventory()">Inventory (I)</button>

    <div id="main-menu-modal" class="modal" style="width:520px; z-index: 300;">
        <h2>Shapes Survivor</h2>
        <div class="levelup-sidebar-muted" style="text-align:center; max-width: 420px;">
            Survive as long as you can. Level up and find gear.
        </div>

        <div class="main-menu-meta">
            <div id="main-menu-version" class="levelup-sidebar-muted" style="text-align:center;"></div>
            <a id="main-menu-patch-notes" class="main-menu-link" href="#">Patch Notes</a>
        </div>

        <div class="difficulty-select-container" style="margin-top: 20px; text-align: center;">
            <label for="difficulty-select" style="color: #ccc; margin-right: 10px;">Difficulty:</label>
            <select id="difficulty-select" style="padding: 5px; background: #333; color: white; border: 1px solid #555;">
                <option value="easy">Easy</option>
                <option value="normal" selected>Normal</option>
                <option value="hard">Hard</option>
                <option value="nightmare">Nightmare</option>
            </select>
            <div id="difficulty-desc" class="levelup-sidebar-muted" style="margin-top: 5px; font-size: 0.9em;">The standard challenge.</div>
        </div>

        <div class="settings-container" style="margin-top: 10px; text-align: center;">
             <label style="color: #ccc; font-size: 0.9em; cursor: pointer;">
                <input type="checkbox" id="low-quality-toggle" style="vertical-align: middle; margin-right: 6px;">
                Low FX Mode (Better Performance)
            </label>
        </div>

        <div class="card-actions" style="width:100%; justify-content:center; margin-top: 14px; flex-direction: column; align-items: center;">
            <button class="btn" id="main-menu-start-btn" style="margin-top:0;">Start</button>
            <button class="btn" id="main-menu-reset-btn" style="margin-top:10px; background: rgba(192, 57, 43, 0.3); border: 1px solid #c0392b; font-size: 0.8em; padding: 6px 12px;">Reset Data</button>
        </div>
        <div class="levelup-sidebar-muted" style="text-align:center; margin-top: 10px;">Press Enter to start</div>
    </div>

    <div id="character-select-modal" class="modal" style="width:720px; z-index: 300;">
        <h2>Select Your Character</h2>
        <div id="character-select-container" class="character-select-container"></div>
        <div class="card-actions" style="width:100%; justify-content:center; margin-top: 14px;">
            <button class="btn" id="character-select-back-btn" style="margin-top:0; background: rgba(0,0,0,0.25); border: 1px solid #555;">Back</button>
        </div>
    </div>

    <div id="trait-select-modal" class="modal" style="width:720px; z-index: 300;">
        <h2>Choose Your Starting Trait</h2>
        <div id="trait-select-container" class="character-select-container"></div>
        <div class="card-actions" style="width:100%; justify-content:center; margin-top: 14px;">
            <button class="btn" id="trait-select-back-btn" style="margin-top:0; background: rgba(0,0,0,0.25); border: 1px solid #555;">Back</button>
        </div>
    </div>

    <div id="end-screen-modal" class="modal" style="width:560px; z-index: 300;">
        <h2>Run Summary</h2>
        <div id="end-screen-stats" style="width:100%;"></div>
        <div class="card-actions" style="width:100%; justify-content:center;">
            <button class="btn" id="end-screen-retry-btn" style="margin-top:0;">Play Again</button>
            <button class="btn" id="end-screen-menu-btn" style="margin-top:0; background: rgba(0,0,0,0.25); border: 1px solid #555;">Main Menu</button>
        </div>
        <div class="levelup-sidebar-muted" style="text-align:center; margin-top: 10px;">Press Enter to play again</div>
    </div>

    <div id="levelup-modal" class="modal">
        <h2>Choose Your Reward</h2>
        <div class="levelup-layout">
            <div id="upgrade-inventory-panel" class="levelup-sidebar">
                <div class="levelup-sidebar-title">Current Gear</div>
                <div id="upgrade-inventory-items"></div>
                <div class="levelup-sidebar-title" style="margin-top:12px;">Artifacts</div>
                <div id="upgrade-artifact-summary" class="levelup-sidebar-muted">0 collected</div>
            </div>
            <div id="card-container"></div>
        </div>
        <div class="card-actions" style="width:100%; justify-content:center;">
            <button class="btn" id="levelup-exit-btn" style="margin-top:0;">Exit</button>
        </div>
    </div>

    <div id="accessory-replace-modal" class="modal" style="width:520px; z-index: 200;">
        <h2>Replace Accessory</h2>
        <div id="accessory-replace-summary" class="levelup-sidebar-muted" style="margin-bottom: 14px; text-align:center;"></div>
        <div class="card-actions">
            <button class="btn-small btn-small-primary" id="replace-accessory1-btn">Replace Accessory 1</button>
            <button class="btn-small btn-small-primary" id="replace-accessory2-btn">Replace Accessory 2</button>
            <button class="btn-small" id="replace-accessory-cancel-btn">Cancel</button>
        </div>
    </div>

    <div id="inventory-modal" class="modal">
        <h2>Character Sheet</h2>
        
        <div class="section-header">Equipment</div>
        <div id="inventory-grid">
            <div class="paper-doll-slot" id="slot-weapon">
                <span class="slot-label">Main Weapon</span>
                <div class="slot-content"></div>
            </div>
            <div class="paper-doll-slot" id="slot-armor">
                <span class="slot-label">Body Armor</span>
                <div class="slot-content"></div>
            </div>
            <div class="paper-doll-slot" id="slot-accessory1">
                <span class="slot-label">Accessory</span>
                <div class="slot-content"></div>
            </div>
            <div class="paper-doll-slot" id="slot-accessory2">
                <span class="slot-label">Accessory</span>
                <div class="slot-content"></div>
            </div>
        </div>

        <div class="section-header">Artifact Collection (Unlimited)</div>
        <div id="artifact-container">
            <!-- Artifacts go here -->
        </div>

        <div id="stats-panel"></div>
        <button class="btn" onclick="Game.toggleInventory()">Close</button>
    </div>

    <div id="dev-gear-modal" class="modal" style="width:720px; z-index: 260;">
        <h2>Dev: Grant Gear</h2>

        <div class="dev-gear-grid">
            <div class="dev-gear-field">
                <label for="dev-gear-type">Type</label>
                <select id="dev-gear-type"></select>
            </div>
            <div class="dev-gear-field">
                <label for="dev-gear-rarity">Rarity</label>
                <select id="dev-gear-rarity"></select>
            </div>
            <div class="dev-gear-field" id="dev-gear-archetype-field">
                <label for="dev-gear-archetype">Archetype</label>
                <select id="dev-gear-archetype"></select>
            </div>
            <div class="dev-gear-field" id="dev-gear-legendary-field" style="display:none;">
                <label for="dev-gear-legendary">Legendary</label>
                <select id="dev-gear-legendary"></select>
            </div>
        </div>

        <div class="dev-gear-grid" style="margin-top: 12px;">
            <div class="dev-gear-field" id="dev-gear-weapon-effect-field" style="display:none;">
                <label for="dev-gear-weapon-effect">Weapon Effect</label>
                <select id="dev-gear-weapon-effect"></select>
            </div>
            <div class="dev-gear-field" id="dev-gear-enhancement-field" style="display:none;">
                <label for="dev-gear-enhancement">Accessory Enhancement</label>
                <select id="dev-gear-enhancement"></select>
            </div>
            <div class="dev-gear-field" style="visibility:hidden;">
                <label>Spacer</label>
                <select disabled></select>
            </div>
        </div>

        <div class="dev-gear-section" style="width:100%;">
            <div class="section-header" style="margin-top: 14px;">Affixes (optional)</div>
            <div id="dev-gear-affix-list" class="dev-gear-affix-list"></div>
            <div class="levelup-sidebar-muted" style="margin-top: 6px; text-align:center;">
                Select any number of affixes (dev-only).
            </div>
        </div>

        <div class="card-actions" style="width:100%; justify-content:center;">
            <button class="btn-small btn-small-primary" id="dev-gear-grant-btn">Grant & Equip</button>
            <button class="btn-small" id="dev-gear-close-btn">Close</button>
        </div>
        <div class="levelup-sidebar-muted" style="text-align:center; margin-top: 10px;">F10 toggles this menu (Dev Mode only)</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- Item System (Constants) - LOAD FIRST -->
    <script src="src/items/constants/item-types.js"></script>
    <script src="src/items/constants/rarity-system.js"></script>

    <!-- Core constants (version, links, etc.) -->
    <script src="src/core/constants.js"></script>
    <script src="src/core/save-system.js"></script>

    <!-- Utilities -->
    <script src="src/utils/random-utils.js"></script>
    <script src="src/utils/data-loader.js"></script>
    <script src="src/utils/stat-calculator.js"></script>
    <script src="src/utils/engine-utils.js"></script>

    <!-- Effects System -->
    <script src="src/effects/effect-utils.js"></script>
    <script src="src/effects/status-effects.js"></script>
    <script src="src/effects/buff-manager.js"></script>

    <!-- Item System (Modular Components) - LOAD BEFORE loot-system.js -->
    <script src="src/items/constants/name-generator.js"></script>
    <script src="src/items/generation-core.js"></script>

    <!-- Core Game -->
    <script src="src/core/input.js"></script>
    <script src="src/core/dev-mode.js"></script>

    <!-- Rendering -->
    <script src="src/rendering/visual-effects.js"></script>

    <!-- UI -->
    <script src="src/ui/hud-manager.js"></script>
    <script src="src/ui/inventory-ui.js"></script>
    <script src="src/ui/ui-manager.js"></script>

    <!-- Entities -->
    <script src="src/entities/entity.js"></script>
    <script src="src/entities/beam/beam.js"></script>
    <script src="src/entities/player/player.js"></script>
    <script src="src/entities/enemy/enemy.js"></script>
    <script src="src/entities/projectile/projectile.js"></script>
    <script src="src/entities/pickups/boss-chest.js"></script>

    <!-- Game Engine (Main Loop) -->
    <script src="src/core/game-engine.js"></script>
    <script>
        window.onload = () => Game.init();
    </script>
</body>
</html>